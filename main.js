/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";function t(t,e){for(var r=e*e,n=r-e,o=[],a=e;a<r-e;a+=e)o.push(a);for(var i=e-1,c=r-1,l=[],u=2*e-1;u<r-e+e-1;u+=e)l.push(u);for(var s=[],f=1;f<e-1;f++)s.push(f);for(var h=[],y=r-e+1;y<r-1;y++)h.push(y);return 0===t?"top-left":t===i?"top-right":t===n?"bottom-left":t===c?"bottom-right":s.includes(t)?"top":h.includes(t)?"bottom":o.includes(t)?"left":l.includes(t)?"right":"center"}function e(t){return t<15?"critical":t<50?"normal":"high"}function r(t,e,r){var n=Math.floor(t/r),o=t%r,a=Math.floor(e/r),i=e%r;return Math.max(Math.abs(a-n),Math.abs(i-o))}function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=a(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return c=t.done,t},e:function(t){l=!0,i=t},f:function(){try{c||null==r.return||r.return()}finally{if(l)throw i}}}}function a(t,e){if(t){if("string"==typeof t)return i(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function c(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,l(n.key),n)}}function l(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}var u=function(){return r=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]},n=[{key:"bindToDOM",value:function(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t}},{key:"drawUi",value:function(e){var r=this;this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",function(t){return r.onNewGameClick(t)}),this.saveGameEl.addEventListener("click",function(t){return r.onSaveGameClick(t)}),this.loadGameEl.addEventListener("click",function(t){return r.onLoadGameClick(t)}),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(e);for(var n=0;n<Math.pow(this.boardSize,2);n+=1){var o=document.createElement("div");o.classList.add("cell","map-tile","map-tile-".concat(t(n,this.boardSize))),o.addEventListener("mouseenter",function(t){return r.onCellEnter(t)}),o.addEventListener("mouseleave",function(t){return r.onCellLeave(t)}),o.addEventListener("click",function(t){return r.onCellClick(t)}),this.boardEl.appendChild(o)}this.cells=Array.from(this.boardEl.children)}},{key:"redrawPositions",value:function(t){var r,n=o(this.cells);try{for(n.s();!(r=n.n()).done;)r.value.innerHTML=""}catch(t){n.e(t)}finally{n.f()}var a,i=o(t);try{for(i.s();!(a=i.n()).done;){var c=a.value,l=this.boardEl.children[c.position],u=document.createElement("div");u.classList.add("character",c.character.type);var s=document.createElement("div");s.classList.add("health-level");var f=document.createElement("div");f.classList.add("health-level-indicator","health-level-indicator-".concat(e(c.character.health))),f.style.width="".concat(c.character.health,"%"),s.appendChild(f),u.appendChild(s),l.appendChild(u)}}catch(t){i.e(t)}finally{i.f()}}},{key:"addCellEnterListener",value:function(t){this.cellEnterListeners.push(t)}},{key:"addCellLeaveListener",value:function(t){this.cellLeaveListeners.push(t)}},{key:"addCellClickListener",value:function(t){this.cellClickListeners.push(t)}},{key:"addNewGameListener",value:function(t){this.newGameListeners.push(t)}},{key:"addSaveGameListener",value:function(t){this.saveGameListeners.push(t)}},{key:"addLoadGameListener",value:function(t){this.loadGameListeners.push(t)}},{key:"onCellEnter",value:function(t){t.preventDefault();var e=this.cells.indexOf(t.currentTarget);this.cellEnterListeners.forEach(function(t){return t.call(null,e)})}},{key:"onCellLeave",value:function(t){t.preventDefault();var e=this.cells.indexOf(t.currentTarget);this.cellLeaveListeners.forEach(function(t){return t.call(null,e)})}},{key:"onCellClick",value:function(t){var e=this.cells.indexOf(t.currentTarget);this.cellClickListeners.forEach(function(t){return t.call(null,e)})}},{key:"onNewGameClick",value:function(t){t.preventDefault(),this.newGameListeners.forEach(function(t){return t.call(null)})}},{key:"onSaveGameClick",value:function(t){t.preventDefault(),this.saveGameListeners.forEach(function(t){return t.call(null)})}},{key:"onLoadGameClick",value:function(t){t.preventDefault(),this.loadGameListeners.forEach(function(t){return t.call(null)})}},{key:"selectCell",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(t),this.cells[t].classList.add("selected","selected-".concat(e))}},{key:"deselectCell",value:function(t){var e,r=this.cells[t];(e=r.classList).remove.apply(e,function(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||a(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(Array.from(r.classList).filter(function(t){return t.startsWith("selected")})))}},{key:"showCellTooltip",value:function(t,e){this.cells[e].title=t}},{key:"hideCellTooltip",value:function(t){this.cells[t].title=""}},{key:"showDamage",value:function(t,e){var r=this;return new Promise(function(n){var o=r.cells[t],a=document.createElement("span");a.textContent=e,a.classList.add("damage"),o.appendChild(a),a.addEventListener("animationend",function(){o.removeChild(a),n()})})}},{key:"setCursor",value:function(t){this.boardEl.style.cursor=t}},{key:"checkBinding",value:function(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}},{key:"showCharacterInfo",value:function(t){var e="üéñ "+t.level,r="‚öî "+t.attack,n="üõ° "+t.defence,o="‚ù§ "+t.health;return"".concat(e," ").concat(r," ").concat(n," ").concat(o)}}],l=[{key:"showError",value:function(t){alert(t)}},{key:"showMessage",value:function(t){alert(t)}}],n&&c(r.prototype,n),l&&c(r,l),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,l}();const s="prairie",f="desert",h="arctic",y="mountain";function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function v(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,b(n.key),n)}}function m(t,e,r){return e&&v(t.prototype,e),r&&v(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function b(t){var e=function(t){if("object"!=p(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=p(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==p(e)?e:e+""}var d=m(function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.characters=e});function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function w(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,S(n.key),n)}}function S(t){var e=function(t){if("object"!=g(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=g(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==g(e)?e:e+""}var P=function(){return t=function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"generic";if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(this instanceof t?this.constructor:void 0)===t)throw new Error("You cannot create instances of the Character base class directly");if("number"!=typeof e||e<1||e>4)throw new Error("Level must be a number between 1 and 4");if(this.level=1,this.type=r,this.initStats(),e>1)for(var n=this.level;n<e;n++)this.levelUp()},(e=[{key:"initStats",value:function(){throw new Error("initStats –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –ø–æ–¥–∫–ª–∞—Å—Å–µ")}},{key:"levelUp",value:function(){this.level<4&&(this.level+=1,this.attack=Math.floor(Math.max(this.attack,this.attack*(80+this.health)/100)),this.defence=Math.floor(Math.max(this.defence,this.defence*(80+this.health)/100)),this.health=Math.min(100,this.health+80))}}])&&w(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function O(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,j(n.key),n)}}function k(t,e,r){return e&&O(t.prototype,e),r&&O(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function j(t){var e=function(t){if("object"!=C(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=C(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==C(e)?e:e+""}var E=k(function t(e,r){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!(e instanceof P))throw new Error("character must be instance of Character or its children");if("number"!=typeof r)throw new Error("position must be a number");this.character=e,this.position=r});function T(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function L(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var l=n&&n.prototype instanceof c?n:c,u=Object.create(l.prototype);return _(u,"_invoke",function(r,n,o){var a,c,l,u=0,s=o||[],f=!1,h={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return a=e,c=0,l=t,h.n=r,i}};function y(r,n){for(c=r,l=n,e=0;!f&&u&&!o&&e<s.length;e++){var o,a=s[e],y=h.p,p=a[2];r>3?(o=p===n)&&(l=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=t):a[0]<=y&&((o=r<2&&y<a[1])?(c=0,h.v=n,h.n=a[1]):y<p&&(o=r<3||a[0]>n||n>p)&&(a[4]=r,a[5]=n,h.n=p,c=0))}if(o||r>1)return i;throw f=!0,n}return function(o,s,p){if(u>1)throw TypeError("Generator is already running");for(f&&1===s&&y(s,p),c=s,l=p;(e=c<2?t:l)||!f;){a||(c?c<3?(c>1&&(h.n=-1),y(c,l)):h.n=l:h.v=l);try{if(u=2,a){if(c||(o="next"),e=a[o]){if(!(e=e.call(a,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,c<2&&(c=0)}else 1===c&&(e=a.return)&&e.call(a),c<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=t}else if((e=(f=h.n<0)?l:r.call(n,h))!==i)break}catch(e){a=t,c=1,l=e}finally{u=1}}return{value:e,done:f}}}(r,o,a),!0),u}var i={};function c(){}function l(){}function u(){}e=Object.getPrototypeOf;var s=[][n]?e(e([][n]())):(_(e={},n,function(){return this}),e),f=u.prototype=c.prototype=Object.create(s);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,_(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return l.prototype=u,_(f,"constructor",u),_(u,"constructor",l),l.displayName="GeneratorFunction",_(u,o,"GeneratorFunction"),_(f),_(f,o,"Generator"),_(f,n,function(){return this}),_(f,"toString",function(){return"[object Generator]"}),(L=function(){return{w:a,m:h}})()}function _(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}_=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var a=function(e,r){_(t,e,function(t){return this._invoke(e,r,t)})};a("next",0),a("throw",1),a("return",2)}},_(t,e,r,n)}var G=L().m(x);function x(t,e){var r,n;return L().w(function(o){for(;;)switch(o.n){case 0:return r=t[Math.floor(Math.random()*t.length)],n=Math.floor(Math.random()*e+1),o.n=1,new r(n);case 1:o.n=0;break;case 2:return o.a(2)}},G)}function M(t,e,r){for(var n=[],o=x(t,e),a=0;a<r;a++)n.push(o.next().value);return new d(n)}function A(t,e,r){var n,o=[],a=new Set,i=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return T(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?T(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){c=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}(t.characters);try{for(i.s();!(n=i.n()).done;){for(var c=n.value,l=null,u=0;null===l&&u<100;){u++;var s=e[Math.floor(Math.random()*e.length)],f=Math.floor(Math.random()*r)*r+s;a.has(f)||(l=f,a.add(f))}null!==l?o.push(new E(c,l)):console.warn("Couldn't find a unique position for the character")}}catch(t){i.e(t)}finally{i.f()}return o}function I(t){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(t)}function U(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,R(n.key),n)}}function R(t){var e=function(t){if("object"!=I(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=I(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==I(e)?e:e+""}function B(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(B=function(){return!!t})()}function D(t){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},D(t)}function N(t,e){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},N(t,e)}var F=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e,r){return e=D(e),function(t,e){if(e&&("object"==I(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,B()?Reflect.construct(e,r||[],D(t).constructor):e.apply(t,r))}(this,e,[t,"bowman"])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&N(t,e)}(e,t),r=e,(n=[{key:"initStats",value:function(){this.health=50,this.attack=25,this.defence=25}}])&&U(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(P);function z(t){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},z(t)}function H(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,q(n.key),n)}}function q(t){var e=function(t){if("object"!=z(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=z(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==z(e)?e:e+""}function $(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return($=function(){return!!t})()}function J(t){return J=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},J(t)}function Y(t,e){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Y(t,e)}var W=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e,r){return e=J(e),function(t,e){if(e&&("object"==z(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,$()?Reflect.construct(e,r||[],J(t).constructor):e.apply(t,r))}(this,e,[t,"swordsman"])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Y(t,e)}(e,t),r=e,(n=[{key:"initStats",value:function(){this.health=50,this.attack=40,this.defence=10}}])&&H(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(P);function K(t){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K(t)}function Q(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,V(n.key),n)}}function V(t){var e=function(t){if("object"!=K(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=K(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==K(e)?e:e+""}function X(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(X=function(){return!!t})()}function Z(t){return Z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Z(t)}function tt(t,e){return tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tt(t,e)}var et=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e,r){return e=Z(e),function(t,e){if(e&&("object"==K(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,X()?Reflect.construct(e,r||[],Z(t).constructor):e.apply(t,r))}(this,e,[t,"magician"])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tt(t,e)}(e,t),r=e,(n=[{key:"initStats",value:function(){this.health=50,this.attack=10,this.defence=40}}])&&Q(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(P);function rt(t){return rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rt(t)}function nt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ot(n.key),n)}}function ot(t){var e=function(t){if("object"!=rt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=rt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==rt(e)?e:e+""}function at(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(at=function(){return!!t})()}function it(t){return it=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},it(t)}function ct(t,e){return ct=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ct(t,e)}var lt=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e,r){return e=it(e),function(t,e){if(e&&("object"==rt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,at()?Reflect.construct(e,r||[],it(t).constructor):e.apply(t,r))}(this,e,[t,"daemon"])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ct(t,e)}(e,t),r=e,(n=[{key:"initStats",value:function(){this.health=50,this.attack=10,this.defence=10}}])&&nt(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(P);function ut(t){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ut(t)}function st(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ft(n.key),n)}}function ft(t){var e=function(t){if("object"!=ut(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=ut(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ut(e)?e:e+""}function ht(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ht=function(){return!!t})()}function yt(t){return yt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},yt(t)}function pt(t,e){return pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},pt(t,e)}var vt=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e,r){return e=yt(e),function(t,e){if(e&&("object"==ut(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,ht()?Reflect.construct(e,r||[],yt(t).constructor):e.apply(t,r))}(this,e,[t,"undead"])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pt(t,e)}(e,t),r=e,(n=[{key:"initStats",value:function(){this.health=50,this.attack=40,this.defence=10}}])&&st(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(P);function mt(t){return mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mt(t)}function bt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,dt(n.key),n)}}function dt(t){var e=function(t){if("object"!=mt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=mt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==mt(e)?e:e+""}function gt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(gt=function(){return!!t})()}function wt(t){return wt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},wt(t)}function St(t,e){return St=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},St(t,e)}var Pt=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e,r){return e=wt(e),function(t,e){if(e&&("object"==mt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,gt()?Reflect.construct(e,r||[],wt(t).constructor):e.apply(t,r))}(this,e,[t,"vampire"])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&St(t,e)}(e,t),r=e,(n=[{key:"initStats",value:function(){this.health=50,this.attack=25,this.defence=25}}])&&bt(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(P);const Ct="auto",Ot="pointer",kt="crosshair",jt="not-allowed";function Et(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var l=n&&n.prototype instanceof c?n:c,u=Object.create(l.prototype);return Tt(u,"_invoke",function(r,n,o){var a,c,l,u=0,s=o||[],f=!1,h={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return a=e,c=0,l=t,h.n=r,i}};function y(r,n){for(c=r,l=n,e=0;!f&&u&&!o&&e<s.length;e++){var o,a=s[e],y=h.p,p=a[2];r>3?(o=p===n)&&(l=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=t):a[0]<=y&&((o=r<2&&y<a[1])?(c=0,h.v=n,h.n=a[1]):y<p&&(o=r<3||a[0]>n||n>p)&&(a[4]=r,a[5]=n,h.n=p,c=0))}if(o||r>1)return i;throw f=!0,n}return function(o,s,p){if(u>1)throw TypeError("Generator is already running");for(f&&1===s&&y(s,p),c=s,l=p;(e=c<2?t:l)||!f;){a||(c?c<3?(c>1&&(h.n=-1),y(c,l)):h.n=l:h.v=l);try{if(u=2,a){if(c||(o="next"),e=a[o]){if(!(e=e.call(a,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,c<2&&(c=0)}else 1===c&&(e=a.return)&&e.call(a),c<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=t}else if((e=(f=h.n<0)?l:r.call(n,h))!==i)break}catch(e){a=t,c=1,l=e}finally{u=1}}return{value:e,done:f}}}(r,o,a),!0),u}var i={};function c(){}function l(){}function u(){}e=Object.getPrototypeOf;var s=[][n]?e(e([][n]())):(Tt(e={},n,function(){return this}),e),f=u.prototype=c.prototype=Object.create(s);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Tt(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return l.prototype=u,Tt(f,"constructor",u),Tt(u,"constructor",l),l.displayName="GeneratorFunction",Tt(u,o,"GeneratorFunction"),Tt(f),Tt(f,o,"Generator"),Tt(f,n,function(){return this}),Tt(f,"toString",function(){return"[object Generator]"}),(Et=function(){return{w:a,m:h}})()}function Tt(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Tt=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var a=function(e,r){Tt(t,e,function(t){return this._invoke(e,r,t)})};a("next",0),a("throw",1),a("return",2)}},Tt(t,e,r,n)}function Lt(t,e,r,n,o,a,i){try{var c=t[a](i),l=c.value}catch(t){return void r(t)}c.done?e(l):Promise.resolve(l).then(n,o)}function _t(t,e,n,o){var a=function(t){switch(t){case"swordsman":case"undead":return 4;case"bowman":case"vampire":return 2;case"magician":case"daemon":return 1;default:throw new Error("Unknown character type: ".concat(t))}}(n);return r(t,e,o)<=a}function Gt(t,e,n,o){var a=function(t){switch(t){case"swordsman":case"undead":return 1;case"bowman":case"vampire":return 2;case"magician":case"daemon":return 4;default:throw new Error("Unknown character type: ".concat(t))}}(n);return r(t,e,o)<=a}function xt(t,e,r){t&&(r.getPositionedCharacter(e)?console.warn("–ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å—Å—è –≤ –∑–∞–Ω—è—Ç—É—é –∫–ª–µ—Ç–∫—É!"):(console.log("".concat(t.character.type," –±—ã–ª –≤ ").concat(t.position)),r.positionedCharacters=r.positionedCharacters.filter(function(e){return e.position!==t.position}),t.position=e,r.positionedCharacters.push(t),r.gameState.isPlayerTurn()&&(r.selectedCell=e),r.gamePlay.redrawPositions(r.positionedCharacters),console.log("".concat(t.character.type," —Å–¥–µ–ª–∞–ª –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ ").concat(e)),r.gameState.changeTurn(),r.checkGameStatus()))}function Mt(t,e,r){return At.apply(this,arguments)}function At(){var t;return t=Et().m(function t(e,r,n){var o,a,i;return Et().w(function(t){for(;;)switch(t.n){case 0:if(o=n.getPositionedCharacter(r)){t.n=1;break}return t.a(2);case 1:return a=o.character,i=Math.floor(Math.max(e.attack-a.defence,.1*e.attack)),a.health-=i,t.n=2,n.gamePlay.showDamage(r,i);case 2:o.character.health<=0&&(n.positionedCharacters=n.positionedCharacters.filter(function(t){return t!==o}),n.isPlayerCharacter(e)&&n.gameState.addScore(100)),n.gamePlay.redrawPositions(n.positionedCharacters),console.log("".concat(e.type," –∞—Ç–∞–∫–æ–≤–∞–ª ").concat(o.character.type)),n.gameState.changeTurn(),n.checkGameStatus();case 3:return t.a(2)}},t)}),At=function(){var e=this,r=arguments;return new Promise(function(n,o){var a=t.apply(e,r);function i(t){Lt(a,n,o,i,c,"next",t)}function c(t){Lt(a,n,o,i,c,"throw",t)}i(void 0)})},At.apply(this,arguments)}function It(t,e){var r=e.gamePlay.boardSize,n=e.getPositionedCharacter(t);if(!n)return[];for(var o=n.character,a=[],i=0;i<r*r;i++)if(i!==t){var c=e.getPositionedCharacter(i);if(Gt(t,i,o.type,r)&&c&&e.isPlayerCharacter(o)!==e.isPlayerCharacter(c.character)){a.push(i);continue}!c&&_t(t,i,o.type,r)&&a.push(i)}return a}function Ut(t){return Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ut(t)}function Rt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function Bt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Dt(n.key),n)}}function Dt(t){var e=function(t){if("object"!=Ut(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Ut(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ut(e)?e:e+""}var Nt=function(){function t(){var e,r,n,o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=this,n=function(){o.turn="player"===o.turn?"computer":"player",o.runAfterTurnCallbacks()},(r=Dt(r="changeTurn"))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,this.turn="player",this.afterTurnCallbacks=[],this.score=0,this.maxScore=0,this.gameOver=!1,this.gameLevel=1,this.maxLevel=1,this.positionedCharacters=[]}return e=t,r=[{key:"isPlayerTurn",value:function(){return"player"===this.turn}},{key:"onAfterTurn",value:function(t){"function"==typeof t&&this.afterTurnCallbacks.push(t)}},{key:"runAfterTurnCallbacks",value:function(){var t,e=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Rt(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Rt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){c=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}(this.afterTurnCallbacks);try{for(e.s();!(t=e.n()).done;){var r=t.value;try{r(this.turn)}catch(t){console.error("Error in afterTurn callback",t)}}}catch(t){e.e(t)}finally{e.f()}}},{key:"addScore",value:function(t){this.score+=t,this.score>this.maxScore&&(this.maxScore=this.score)}},{key:"setGameOver",value:function(){this.gameOver=!0}},{key:"serialize",value:function(){return{turn:this.turn,score:this.score,maxScore:this.maxScore,gameOver:this.gameOver,gameLevel:this.gameLevel,maxLevel:this.maxLevel,positionedCharacters:this.positionedCharacters.map(function(t){return{position:t.position,character:{type:t.character.type,level:t.character.level,attack:t.character.attack,defence:t.character.defence,health:t.character.health}}})}}}],n=[{key:"from",value:function(e){var r,n,o,a,i,c,l;if(!e)return new t;var u=new t;return u.turn=null!==(r=e.turn)&&void 0!==r?r:"player",u.score=null!==(n=e.score)&&void 0!==n?n:0,u.maxScore=null!==(o=e.maxScore)&&void 0!==o?o:0,u.gameOver=null!==(a=e.gameOver)&&void 0!==a&&a,u.gameLevel=null!==(i=e.gameLevel)&&void 0!==i?i:1,u.maxLevel=null!==(c=e.maxLevel)&&void 0!==c?c:1,u.positionedCharacters=null!==(l=e.positionedCharacters)&&void 0!==l?l:[],u}}],r&&Bt(e.prototype,r),n&&Bt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r,n}();function Ft(t){return Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ft(t)}function zt(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}throw new TypeError(Ft(t)+" is not iterable")}function Ht(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return qt(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){c=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}function qt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function $t(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var l=n&&n.prototype instanceof c?n:c,u=Object.create(l.prototype);return Jt(u,"_invoke",function(r,n,o){var a,c,l,u=0,s=o||[],f=!1,h={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return a=e,c=0,l=t,h.n=r,i}};function y(r,n){for(c=r,l=n,e=0;!f&&u&&!o&&e<s.length;e++){var o,a=s[e],y=h.p,p=a[2];r>3?(o=p===n)&&(l=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=t):a[0]<=y&&((o=r<2&&y<a[1])?(c=0,h.v=n,h.n=a[1]):y<p&&(o=r<3||a[0]>n||n>p)&&(a[4]=r,a[5]=n,h.n=p,c=0))}if(o||r>1)return i;throw f=!0,n}return function(o,s,p){if(u>1)throw TypeError("Generator is already running");for(f&&1===s&&y(s,p),c=s,l=p;(e=c<2?t:l)||!f;){a||(c?c<3?(c>1&&(h.n=-1),y(c,l)):h.n=l:h.v=l);try{if(u=2,a){if(c||(o="next"),e=a[o]){if(!(e=e.call(a,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,c<2&&(c=0)}else 1===c&&(e=a.return)&&e.call(a),c<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=t}else if((e=(f=h.n<0)?l:r.call(n,h))!==i)break}catch(e){a=t,c=1,l=e}finally{u=1}}return{value:e,done:f}}}(r,o,a),!0),u}var i={};function c(){}function l(){}function u(){}e=Object.getPrototypeOf;var s=[][n]?e(e([][n]())):(Jt(e={},n,function(){return this}),e),f=u.prototype=c.prototype=Object.create(s);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Jt(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return l.prototype=u,Jt(f,"constructor",u),Jt(u,"constructor",l),l.displayName="GeneratorFunction",Jt(u,o,"GeneratorFunction"),Jt(f),Jt(f,o,"Generator"),Jt(f,n,function(){return this}),Jt(f,"toString",function(){return"[object Generator]"}),($t=function(){return{w:a,m:h}})()}function Jt(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Jt=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var a=function(e,r){Jt(t,e,function(t){return this._invoke(e,r,t)})};a("next",0),a("throw",1),a("return",2)}},Jt(t,e,r,n)}function Yt(t,e,r,n,o,a,i){try{var c=t[a](i),l=c.value}catch(t){return void r(t)}c.done?e(l):Promise.resolve(l).then(n,o)}function Wt(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var a=t.apply(e,r);function i(t){Yt(a,n,o,i,c,"next",t)}function c(t){Yt(a,n,o,i,c,"throw",t)}i(void 0)})}}function Kt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Qt(n.key),n)}}function Qt(t){var e=function(t){if("object"!=Ft(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Ft(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ft(e)?e:e+""}var Vt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gameController=e},e=[{key:"makeMove",value:(a=Wt($t().m(function t(){return $t().w(function(t){for(;;)switch(t.n){case 0:if(this.gameController.gameState.isPlayerTurn()){t.n=2;break}return t.n=1,this.attack();case 1:if(t.v){t.n=2;break}return t.n=2,this.move();case 2:return t.a(2)}},t,this)})),function(){return a.apply(this,arguments)})},{key:"attack",value:(o=Wt($t().m(function t(){var e,r,n,o,a,i,c,l,u,s,f,h,y=this;return $t().w(function(t){for(;;)switch(t.n){case 0:e=[],r=this.gameController.positionedCharacters.filter(function(t){return!y.gameController.isPlayerCharacter(t.character)}),n=Ht(r);try{for(n.s();!(o=n.n()).done;){a=o.value,i=Ht(this.gameController.positionedCharacters);try{for(i.s();!(c=i.n()).done;)l=c.value,this.gameController.isPlayerCharacter(l.character)&&Gt(a.position,l.position,a.character.type,this.gameController.gamePlay.boardSize)&&e.push({attacker:a,target:l})}catch(t){i.e(t)}finally{i.f()}}}catch(t){n.e(t)}finally{n.f()}if(!(e.length>0)){t.n=2;break}u=e[0],s=Ht(e);try{for(s.s();!(f=s.n()).done;)(h=f.value).target.character.health<u.target.character.health&&(u=h)}catch(t){s.e(t)}finally{s.f()}return t.n=1,Mt(u.attacker.character,u.target.position,this.gameController);case 1:return t.a(2,!0);case 2:return t.a(2,!1)}},t,this)})),function(){return o.apply(this,arguments)})},{key:"move",value:(n=Wt($t().m(function t(){var e,n,o,a,i,c,l,u,s=this;return $t().w(function(t){for(;;)switch(t.n){case 0:e=this.gameController.positionedCharacters.filter(function(t){return!s.gameController.isPlayerCharacter(t.character)}),n=[],o=Ht(e),t.p=1,i=$t().m(function t(){var e,o,i,c,l,u,f,h,y;return $t().w(function(t){for(;;)switch(t.n){case 0:if(e=a.value,o=s.findClosestEnemy(e.position)){t.n=1;break}return t.a(2,0);case 1:if(0!==(i=It(e.position,s.gameController).filter(function(t){return t!==e.position}).filter(function(t){return!s.gameController.getPositionedCharacter(t)})).length){t.n=2;break}return t.a(2,0);case 2:c=i[0],l=1/0,u=Ht(i);try{for(u.s();!(f=u.n()).done;)h=f.value,(y=r(h,o.position,s.gameController.gamePlay.boardSize))<l&&(l=y,c=h)}catch(t){u.e(t)}finally{u.f()}n.push({attacker:e,bestMove:c});case 3:return t.a(2)}},t)}),o.s();case 2:if((a=o.n()).done){t.n=5;break}return t.d(zt(i()),3);case 3:if(0!==t.v){t.n=4;break}return t.a(3,4);case 4:t.n=2;break;case 5:t.n=7;break;case 6:t.p=6,u=t.v,o.e(u);case 7:return t.p=7,o.f(),t.f(7);case 8:if(!(n.length>0)){t.n=9;break}return c=n[Math.floor(Math.random()*n.length)],l=this.gameController.getPositionedCharacter(c.attacker.position),t.n=9,xt(l,c.bestMove,this.gameController);case 9:return t.a(2)}},t,this,[[1,6,7,8]])})),function(){return n.apply(this,arguments)})},{key:"findClosestEnemy",value:function(t){var e,n=null,o=1/0,a=Ht(this.gameController.positionedCharacters);try{for(a.s();!(e=a.n()).done;){var i=e.value;if(this.gameController.isPlayerCharacter(i.character)){var c=r(t,i.position,this.gameController.gamePlay.boardSize);c<o&&(o=c,n=i)}}}catch(t){a.e(t)}finally{a.f()}return n}}],e&&Kt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,o,a}();function Xt(t){return Xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xt(t)}function Zt(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var l=n&&n.prototype instanceof c?n:c,u=Object.create(l.prototype);return te(u,"_invoke",function(r,n,o){var a,c,l,u=0,s=o||[],f=!1,h={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return a=e,c=0,l=t,h.n=r,i}};function y(r,n){for(c=r,l=n,e=0;!f&&u&&!o&&e<s.length;e++){var o,a=s[e],y=h.p,p=a[2];r>3?(o=p===n)&&(l=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=t):a[0]<=y&&((o=r<2&&y<a[1])?(c=0,h.v=n,h.n=a[1]):y<p&&(o=r<3||a[0]>n||n>p)&&(a[4]=r,a[5]=n,h.n=p,c=0))}if(o||r>1)return i;throw f=!0,n}return function(o,s,p){if(u>1)throw TypeError("Generator is already running");for(f&&1===s&&y(s,p),c=s,l=p;(e=c<2?t:l)||!f;){a||(c?c<3?(c>1&&(h.n=-1),y(c,l)):h.n=l:h.v=l);try{if(u=2,a){if(c||(o="next"),e=a[o]){if(!(e=e.call(a,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,c<2&&(c=0)}else 1===c&&(e=a.return)&&e.call(a),c<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=t}else if((e=(f=h.n<0)?l:r.call(n,h))!==i)break}catch(e){a=t,c=1,l=e}finally{u=1}}return{value:e,done:f}}}(r,o,a),!0),u}var i={};function c(){}function l(){}function u(){}e=Object.getPrototypeOf;var s=[][n]?e(e([][n]())):(te(e={},n,function(){return this}),e),f=u.prototype=c.prototype=Object.create(s);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,te(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return l.prototype=u,te(f,"constructor",u),te(u,"constructor",l),l.displayName="GeneratorFunction",te(u,o,"GeneratorFunction"),te(f),te(f,o,"Generator"),te(f,n,function(){return this}),te(f,"toString",function(){return"[object Generator]"}),(Zt=function(){return{w:a,m:h}})()}function te(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}te=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var a=function(e,r){te(t,e,function(t){return this._invoke(e,r,t)})};a("next",0),a("throw",1),a("return",2)}},te(t,e,r,n)}function ee(t,e,r,n,o,a,i){try{var c=t[a](i),l=c.value}catch(t){return void r(t)}c.done?e(l):Promise.resolve(l).then(n,o)}function re(t){return function(t){if(Array.isArray(t))return oe(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||ne(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ne(t,e){if(t){if("string"==typeof t)return oe(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?oe(t,e):void 0}}function oe(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function ae(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ie(n.key),n)}}function ie(t){var e=function(t){if("object"!=Xt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Xt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Xt(e)?e:e+""}var ce=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gamePlay=e,this.stateService=r,this.characterCount=2,this.allowedTypesOfThePlayer=[F,W,et],this.allowedTypesOfTheEnemy=[lt,vt,Pt],this.positionedCharacter=[],this.selectedCell=null,this.availableMoves=[],this.gameState=new Nt,this.aiController=new Vt(this)},e=[{key:"init",value:function(){var t=this;this.gamePlay.drawUi(s),this.gamePlay.addCellEnterListener(this.onCellEnter.bind(this)),this.gamePlay.addCellLeaveListener(this.onCellLeave.bind(this)),this.gamePlay.addCellClickListener(this.onCellClick.bind(this)),this.gamePlay.addNewGameListener(function(){return t.startNewGame()}),this.gamePlay.addSaveGameListener(function(){return t.saveGame()}),this.gamePlay.addLoadGameListener(function(){return t.loadGame()}),this.registerAfterTurnHandler(),this.startNewGame()}},{key:"registerAfterTurnHandler",value:function(){var t=this;this.gameState.onAfterTurn(function(e){"computer"===e&&setTimeout(function(){t.aiController.makeMove(),t.gamePlay.setCursor(Ct)},100)})}},{key:"getPositionedCharacter",value:function(t){return this.positionedCharacters.find(function(e){return e.position===t})||null}},{key:"isPlayerCharacter",value:function(t){return this.allowedTypesOfThePlayer.some(function(e){return t instanceof e})}},{key:"blockBoard",value:function(){this.gamePlay.cellClickListeners=[],this.gamePlay.cellEnterListeners=[],this.gamePlay.cellLeaveListeners=[],this.gamePlay.setCursor("auto")}},{key:"setLevelTheme",value:function(t){switch(t){case 1:this.gamePlay.drawUi(s);break;case 2:this.gamePlay.drawUi(f),console.log("---Level 2---");break;case 3:this.gamePlay.drawUi(h),console.log("---Level 3---");break;case 4:this.gamePlay.drawUi(y),console.log("---Level 4---")}}},{key:"checkGameStatus",value:function(){var t=this,e=this.positionedCharacters.filter(function(e){return t.isPlayerCharacter(e.character)}),r=this.positionedCharacters.filter(function(e){return!t.isPlayerCharacter(e.character)});if(0===e.length||4===this.gameState.gameLevel&&0===r.length)return this.gameState.setGameOver(),this.blockBoard(),u.showMessage("Game Over! –í–∞—à —Å—á—ë—Ç: ".concat(this.gameState.score,", —Ä–µ–∫–æ—Ä–¥: ").concat(this.gameState.maxScore)),this.gameState.score===4*this.characterCount*100?void u.showMessage("You won! –í–∞—à —Å—á—ë—Ç: ".concat(this.gameState.score,", —Ä–µ–∫–æ—Ä–¥: ").concat(this.gameState.maxScore)):void 0;0===r.length&&(this.levelUpAll(),this.nextLevel())}},{key:"levelUpAll",value:function(){this.gameState.maxLevel+=1;var t,e=function(t){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=ne(t))){e&&(t=e);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,i=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return a=t.done,t},e:function(t){i=!0,o=t},f:function(){try{a||null==e.return||e.return()}finally{if(i)throw o}}}}(this.positionedCharacters);try{for(e.s();!(t=e.n()).done;){var r=t.value;this.isPlayerCharacter(r.character)&&r.character.levelUp()}}catch(t){e.e(t)}finally{e.f()}}},{key:"nextLevel",value:function(){var t=this;this.gameState.gameLevel+=1,this.gameState.changeTurn(),this.setLevelTheme(this.gameState.gameLevel);var e=this.gamePlay.boardSize,r=this.positionedCharacters.filter(function(e){return t.isPlayerCharacter(e.character)}).map(function(t){return t.character});if(0!==r.length){if(r.length<this.characterCount){var n=this.characterCount-r.length,o=M(this.allowedTypesOfThePlayer,this.gameState.maxLevel,n);r=[].concat(re(r),re(o.characters))}this.enemyTeam=M(this.allowedTypesOfTheEnemy,this.gameState.maxLevel,this.characterCount);var a=A(new d(r),[0,1],e),i=A(this.enemyTeam,[e-2,e-1],e);this.positionedCharacters=[].concat(re(a),re(i)),this.gamePlay.redrawPositions(this.positionedCharacters)}else this.gameOver()}},{key:"startNewGame",value:function(){this.gameState.score=0,this.gameState.gameOver=!1,this.gameState.gameLevel=1,this.gameState.maxLevel=1,this.setLevelTheme(this.gameState.gameLevel),this.playerTeam=M(this.allowedTypesOfThePlayer,this.gameState.maxLevel,this.characterCount),this.enemyTeam=M(this.allowedTypesOfTheEnemy,this.gameState.maxLevel,this.characterCount);var t=this.gamePlay.boardSize,e=A(this.playerTeam,[0,1],t),r=A(this.enemyTeam,[t-2,t-1],t);this.positionedCharacters=[].concat(re(e),re(r)),this.gamePlay.redrawPositions(this.positionedCharacters)}},{key:"saveGame",value:function(){this.gameState.positionedCharacters=this.positionedCharacters;var t=this.gameState.serialize();this.stateService.save(t),u.showMessage("–ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!"),console.log("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ:",t)}},{key:"loadGame",value:function(){try{var t=this.stateService.load();if(!t)return void u.showError("–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!");this.gameState=Nt.from(t),this.restoreFromState(t),this.setLevelTheme(this.gameState.gameLevel),this.gamePlay.redrawPositions(this.positionedCharacters),this.registerAfterTurnHandler(),u.showMessage("–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!"),console.log("–ó–∞–≥—Ä—É–∂–µ–Ω–æ:",t)}catch(t){u.showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!"),console.log("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ".concat(t))}}},{key:"restoreFromState",value:function(t){var e,r,n,o,a={swordsman:W,bowman:F,magician:et,daemon:lt,undead:vt,vampire:Pt};this.positionedCharacters=t.positionedCharacters.map(function(t){var e=a[t.character.type];if(!e)throw new Error("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –ø–µ—Ä—Å–æ–Ω–∞–∂–∞: ".concat(t.character.type));var r=new e(t.character.level);return r.attack=t.character.attack,r.defence=t.character.defence,r.health=t.character.health,new E(r,t.position)}),this.selectedCell=null!==(e=t.selectedCell)&&void 0!==e?e:null,this.gameState.gameLevel=null!==(r=t.gameLevel)&&void 0!==r?r:1,this.gameState.maxLevel=null!==(n=t.maxLevel)&&void 0!==n?n:1,this.gameState.turn=null!==(o=t.turn)&&void 0!==o?o:"player"}},{key:"onCellClick",value:(r=Zt().m(function t(e){var r,n,o,a,i;return Zt().w(function(t){for(;;)switch(t.n){case 0:if(null!==this.selectedCell&&(this.gamePlay.deselectCell(this.selectedCell),this.gamePlay.setCursor(Ct),this.availableMoves=[]),!(r=this.getPositionedCharacter(e))||!this.isPlayerCharacter(r.character)){t.n=1;break}return this.gamePlay.selectCell(e),this.selectedCell=e,this.gamePlay.setCursor(Ot),this.availableMoves=It(e,this),t.a(2);case 1:if(null===this.selectedCell){t.n=7;break}if(n=this.getPositionedCharacter(this.selectedCell),o=n.character,a=this.gamePlay.boardSize,!(i=this.getPositionedCharacter(e))||this.isPlayerCharacter(i.character)){t.n=4;break}if(!Gt(this.selectedCell,e,o.type,a)){t.n=3;break}return t.n=2,Mt(o,e,this);case 2:return this.selectedCell=null,this.gamePlay.setCursor(Ct),t.a(2);case 3:t.n=6;break;case 4:if(!_t(this.selectedCell,e,o.type,a)){t.n=6;break}return t.n=5,xt(n,e,this);case 5:return this.selectedCell=null,this.gamePlay.setCursor(Ct),t.a(2);case 6:return u.showError("Unacceptable action"),this.selectedCell=null,this.gamePlay.setCursor(Ct),t.a(2);case 7:u.showError("This is not a player's character");case 8:return t.a(2)}},t,this)}),n=function(){var t=this,e=arguments;return new Promise(function(n,o){var a=r.apply(t,e);function i(t){ee(a,n,o,i,c,"next",t)}function c(t){ee(a,n,o,i,c,"throw",t)}i(void 0)})},function(t){return n.apply(this,arguments)})},{key:"onCellEnter",value:function(t){var e=this.getPositionedCharacter(t);if(e&&this.gamePlay.showCellTooltip(this.gamePlay.showCharacterInfo(e.character),t),null!==this.selectedCell&&this.selectedCell!==t){var r=this.getPositionedCharacter(this.selectedCell);if(!r)return;var n=r.character,o=this.gamePlay.boardSize;this.availableMoves.includes(t)?e&&this.isPlayerCharacter(e.character)?this.gamePlay.setCursor(Ot):_t(this.selectedCell,t,n.type,o)&&!this.getPositionedCharacter(t)?(this.gamePlay.selectCell(t,"green"),this.gamePlay.setCursor(Ot)):e&&!this.isPlayerCharacter(e.character)&&Gt(this.selectedCell,t,n.type,o)?(this.gamePlay.selectCell(t,"red"),this.gamePlay.setCursor(kt)):this.gamePlay.setCursor(jt):this.gamePlay.setCursor(jt)}else this.gamePlay.setCursor(Ct)}},{key:"onCellLeave",value:function(t){this.selectedCell!==t&&this.gamePlay.deselectCell(t),null===this.selectedCell?this.gamePlay.setCursor(Ct):this.gamePlay.setCursor(Ot),this.gamePlay.hideCellTooltip(t)}}],e&&ae(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function le(t){return le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},le(t)}function ue(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,se(n.key),n)}}function se(t){var e=function(t){if("object"!=le(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=le(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==le(e)?e:e+""}var fe=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.storage=e},(e=[{key:"save",value:function(t){this.storage.setItem("state",JSON.stringify(t))}},{key:"load",value:function(){try{return JSON.parse(this.storage.getItem("state"))}catch(t){throw new Error("Invalid state")}}}])&&ue(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}(),he=new u;he.bindToDOM(document.querySelector("#game-container")),new ce(he,new fe(localStorage)).init()})();